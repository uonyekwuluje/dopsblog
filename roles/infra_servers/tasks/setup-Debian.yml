---
- name: Update apt cache.
  apt: update_cache=yes cache_valid_time=86400
  become: true

- name: Download Yarn Installer
  get_url:
    url: https://deb.nodesource.com/setup_14.x
    dest: /tmp/
    mode: 0755
  become: true

- name: Execute the yarn-installer.sh
  command: /tmp/setup_14.x
  become: true
  ignore_errors: true

- name: Delete Temporary File
  file:
     path: /tmp/setup_14.x
     state: absent
  become: true
  ignore_errors: true


- name: Add an Apt signing key
  apt_key:
    url: "https://dl.yarnpkg.com/debian/pubkey.gpg"
    state: present
  become: true 
 
#- name: Install Yarn Keys
#  shell: |
#    curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -
#    curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
#  become: True

- name: Install Apt Repo
  apt_repository:  
     repo: "deb https://dl.yarnpkg.com/debian/ stable main"
     filename: yarn.list
     state: present
  become: True

- name: Installing Dependencies
  apt: 
    name: "{{ packages }}"
  vars:
    packages:
      - python-apt 
      - openjdk-8-jdk
      - libfontconfig
      - libffi-dev
      - libncurses5-dev
  become: true

- name: Installing Ruby Dependencies
  apt:
    name: "{{ packages }}"
  vars:
    packages:
      - gnupg2
      - git-core
      - zlib1g-dev 
      - build-essential 
      - libssl-dev 
      - libreadline-dev 
      - libyaml-dev 
      - libsqlite3-dev 
      - sqlite3 
      - libxml2-dev 
      - libxslt1-dev 
      - libcurl4-openssl-dev 
      - software-properties-common 
      - libffi-dev 
      - nodejs 
      - yarn
      - libffi-dev
      - libncurses5-dev
  become: true
